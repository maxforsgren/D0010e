package event;

import simulator.Event;
import simulator.EventQueue;
import state.Customer;
import state.StoreState;

public class PaymentEvent extends Event{
		private Customer c;
		private StoreState state;
	
	public PaymentEvent(StoreState state, EventQueue queue, Customer c) {
		this.c = c;
		this.state = state;
		this.queue = queue;
		this.time = state.getCheckoutTime();
		
	}
	
	public void execute() {
		
		state.updateTime(time);
		state.setRecentCustomer(c);
		state.setRecentEvent("Betalning");
	
	//detta blir som en loop först betala och lämna, sedan kollar kassakön
	//och uppdaterar den, sedan betala och lämna osv.
		
		//kunden betalar sina varor och lämnar snabbköpet.
		//1. minskar antalet kunder i snabbköpet.
		//2. lägger till att en kund har handlat.
		//3. En kassa blir ledig.
		state.removeCustomerInStore();		//minska antalet kunder i snabbköpet.		
		state.addFinishedCustomers();		//lägger till kunder som har betalat/handlat.
		state.removeCheckoutCustomer();		//tar bort en person från kassan "en kassa blir ledig".
		
		
		//4. Kollar om kassakön inte är tom
		//5. Kund som stått längst i kön/först i arrayen.
		//6. Går till den lediga kassan.
		//7. Genererar en betalningshändelse för C.
		if(!state.isCheckoutLineEmpty()) {			//Om kassakön ej är tom.
			c = state.getFirstCheckoutLine();		//Den som är först i kön går till kassa/betalar.
			state.removeFromCheckoutLine();			//Minskar kön från första position.
			state.addCheckoutCustomer();			//En kassa blir upptagen.    	
			queue.add(new PaymentEvent(state, queue, c));
		}
		else {
			state.removeCheckoutCustomer();			//Förstår ej, om kön är tom varför ska vi då öka 
													//antalet kassor som är lediga?
		}
		
		//Display view
		state.updateState();
		
				
	}

	
	public double getEventTime() {
		return this.time;
	}
	
	

}
